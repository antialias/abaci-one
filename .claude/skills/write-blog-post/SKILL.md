---
name: write-blog-post
description: Creates a new blog post for abaci.one. Use when asked to write, draft, or create a blog post. Handles frontmatter, hero selection, content writing, and inline embeds.
allowed-tools: Read, Write, Edit, Glob, Bash
---

# Write Blog Post

Creates a complete blog post at `apps/web/content/blog/{slug}.md`.

## Step 1: Gather Requirements

Clarify with the user (or infer from context):
- **Topic/title** — what is the post about?
- **Tone** — educational deep-dive, conversational, technical, announcement?
- **Hero type** — see Step 3
- **Embeds** — inline interactive content needed? component or HTML?
- **Featured** — should this appear on the homepage rotation?

## Step 2: Read an Example Post

Pick the most thematically similar existing post and read it before writing:
```bash
ls apps/web/content/blog/
```

## Step 3: Choose a Hero

Four hero types are available. Pick one.

### Option A: React Component (`heroType: component`)
Pre-built components — no image needed, renders live:

| `heroComponentId` | What it shows |
|---|---|
| `difficulty-plot-mastery` | DifficultyPlot2D with mastery progression points |
| `readiness-all-variants` | ReadinessReport in not-ready / almost-ready / ready states |
| `vision-before-after` | Side-by-side before/after with vision detection |
| `vision-showcase` | Triptych: observation mode, mirror mode, ArUco calibration |
| `blame-distribution` | Animated blame attribution for conjunctive BKT |
| `subtraction-scaffolding` | Subtraction (352−117) at three scaffolding levels |
| `ten-frames` | Addition (27+14) from plain notation to ten-frames |
| `multi-digit` | 4-digit addition with progressive place value scaffolding |

```yaml
heroType: component
heroComponentId: ten-frames
```

### Option B: AI-Generated Image (`heroType: generated`)
Write a prompt; image is generated by AI and finalized in the admin panel at `/admin/blog-images`.

```yaml
heroPrompt: "A vibrant illustration of an abacus with colorful beads arranged in patterns..."
heroCrop: "50% 30%"   # optional focal point, set via admin crop editor
```

### Option C: Storybook Capture (`heroType: storybook`)
Screenshots a Storybook story. Requires Storybook running locally on port 6006.

```yaml
heroStoryId: "component-name--variant-name"
```

### Option D: Raw HTML (`heroType: html`)
Custom HTML banner. The HTML file lives at `content/blog/hero-html/{slug}.html`.
Best created via the admin panel's snapshot capture tool (fetches from an internal API URL and saves the HTML automatically). For simple cases, the HTML can be written by hand.

```yaml
heroType: html
# HTML file: content/blog/hero-html/{slug}.html
```

## Step 4: Write the Post

Create `apps/web/content/blog/{slug}.md`.

**Slug rules:** kebab-case, short and descriptive, matches the filename exactly.

```markdown
---
title: 'Post Title Here'
description: >-
  One to two sentence summary for SEO and preview cards.
author: Abaci.one Team
publishedAt: 'YYYY-MM-DD'
updatedAt: 'YYYY-MM-DD'
tags:
  - education
  - tag2
featured: false
heroType: component
heroComponentId: ten-frames
---

Post content in standard Markdown...
```

**Required frontmatter:** `title`, `description`, `author`, `publishedAt`, `updatedAt`, `tags`

**Notes:**
- Dates must be quoted strings in `'YYYY-MM-DD'` format
- Leading H1 matching the title is stripped automatically
- Leading image is stripped automatically if a hero is set

## Step 5: Add Inline Embeds (Optional)

### Embed Marker in Markdown
Place this comment wherever the embed should appear:
```markdown
<!-- EMBED: my-embed-id "Fallback description if component missing" -->
```

### Embed Config File
Create `apps/web/content/blog/embeds/{slug}.json`:
```json
{
  "my-embed-id": { "type": "component", "componentId": "evidence-quality-charts" },
  "another-embed": { "type": "html" }
}
```

### Type A: Component Embeds (`"type": "component"`)
Available inline components:

| `componentId` | What it shows |
|---|---|
| `evidence-quality-charts` | Evidence weighting by help level & response time |
| `automaticity-multipliers` | Automaticity multiplier curves |
| `classification-charts` | BKT skill classification thresholds |
| `skill-difficulty-charts` | Skill-specific difficulty multipliers |
| `three-way-comparison` | BKT vs fluency multipliers vs baseline |
| `validation-results` | Convergence speed results |
| `blame-attribution` | Blame distribution across skills |

### Type B: HTML Embeds (`"type": "html"`)
HTML files live at `content/blog/embed-html/{slug}/{embedId}.html`.

**How to populate HTML embed files:**
The admin panel at `/admin/blog-images` has a "Snapshot Capture" tool per embed that:
1. Calls an internal API URL (e.g. `/api/worksheets/preview`) with a configurable method + body
2. Extracts content via a JSONPath (default `pages.0`)
3. Saves the resulting HTML to the correct file automatically

This is how all the worksheet embed posts work (subtraction, multi-digit, ten-frames). It is the preferred way to create HTML embeds — do NOT try to write worksheet HTML by hand.

For simple custom HTML, you can write the file directly.

## Step 6: Verify

- [ ] File exists at `apps/web/content/blog/{slug}.md`
- [ ] Frontmatter YAML is valid (dates quoted, no bare colons in unquoted values)
- [ ] `publishedAt` / `updatedAt` use `'YYYY-MM-DD'` format
- [ ] `heroComponentId` or `componentId` values are from the registries above
- [ ] If `featured: true`, check current count:
  ```bash
  grep -l "^featured: true" apps/web/content/blog/*.md
  ```
- [ ] If using HTML embeds: remind the user to populate HTML files via `/admin/blog-images`
- [ ] If using `heroType: generated`: remind the user to generate the image at `/admin/blog-images`
